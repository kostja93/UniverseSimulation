<?xml version="1.0" encoding="UTF-8"?>
<X3D profile='Immersive'>
	<ProtoDeclare name="Planet">
		<ProtoInterface>
			<field accessType="initializeOnly" name="radius" type="MFFloat"/>
			<field accessType="inputOutput" name="texture" type="MFString" />
		</ProtoInterface>
		<ProtoBody>
			<Scene>
				<Transform  DEF="planet">
					<Shape>
						<Sphere>
							<IS>
								<connect nodeField="radius" protoField="radius" />
							</IS>
						</Sphere>
						<Appearance>
							<ImageTexture>
								<IS>
									<connect nodeField="url" protoField="texture" />
								</IS>
							</ImageTexture>
						</Appearance>
					</Shape>
				</Transform>
	 		</Scene>
		</ProtoBody>
	</ProtoDeclare>

    <ProtoDeclare name="Rotation">
        <ProtoInterface>
            <field accessType="inputOutput" name="keys" type="MFString" />
            <field accessType="inputOutput" name="values" type="MFString" />
            <field accessType="inputOutput" name="planet" type="MFString" />
        </ProtoInterface>
        <ProtoBody>
			<TimeSensor DEF="time" cycleInterval="12" loop="true"/>
			<OrientationInterpolator DEF="rotationValues" >
                <IS>
                    <connect nodeField="key" protoField="keys" />
                    <connect nodeField="keyValue" protoField="values" />
                </IS>
			</OrientationInterpolator>
			<ROUTE fromNode="time" fromField="fraction_changed" toNode="rotationValues" toField="set_fraction"/>
			<ROUTE fromNode="rotationValues" fromField="value_changed" toField="set_rotation">
                <IS>
                    <connect nodeField="toNode" protoField="planet" />
                </IS>
			</ROUTE>
        </ProtoBody>
    </ProtoDeclare>

	<Scene>
		<Transform DEF="system">
			<ProtoInstance name="Planet">
				<fieldValue name="radius" value="25" />
				<fieldValue name="texture" value="assets/sun.jpg" />
			</ProtoInstance>

			<Transform translation="50 0 0" DEF="system2">
				<ProtoInstance name="Planet">
					<fieldValue name="radius"  value="7" />
					<fieldValue name="texture" value="assets/earth.jpg" />
				</ProtoInstance>
				<Transform translation="15 0 0">
					<ProtoInstance name="Planet">
						<fieldValue name="radius"  value="3" />
						<fieldValue name="texture" value="assets/moon.jpg" />
					</ProtoInstance>
				</Transform>
			</Transform>
			<ProtoInstance>
                <fieldValue name="keys" value="0 0.25 0.5 0.75 1" />
                <fieldValue name="values" value="0 1 0 0, 0 1 0 1.57, 0 1 0 3.14159,0 1 0 4.71159, 0 1 0 6.28318" />
                <fieldValue name="planet" value="system2" />
			</ProtoInstance>
		</Transform>
		<TimeSensor DEF="time" cycleInterval="12" loop="true"/>
		<OrientationInterpolator DEF="rotationSystem" 
			key="0 0.25 0.5 0.75 1" 
			keyValue="0 1 0 0, 0 1 0 1.57, 0 1 0 3.14159,0 1 0 4.71159, 0 1 0 6.28318"/>
		<ROUTE fromNode="time" fromField="fraction_changed" toNode="rotationSystem" toField="set_fraction"/>
		<ROUTE fromNode="rotationSystem" fromField="value_changed" toNode="system" toField="set_rotation"/>
	</Scene>
</X3D>